[【负载均衡】常见的负载均衡算法的实现与应用 - 周二鸭 - 博客园 (cnblogs.com)](https://www.cnblogs.com/jojop/p/13997273.html)





## 一、随机

1. ### 完全随机

2. ### 加权随机

3. ### 加权随机优化

## 二、轮询

1. ### 完全轮询

2. ### 加权轮询

3. ### 平滑加权轮询



## 三、哈希

### 3.1 哈希算法

对同一个关键字进行哈希计算，每次计算都是相同的值，这样就可以将某个 key 确定到一个节点了，可以满足分布式系统的负载均衡需求。

哈希算法最简单的做法就是进行取模运算，比如分布式系统中有 3 个节点，基于 `hash(key) % 3` 公式对数据进行了映射。

如果客户端要获取指定 key 的数据，通过下面的公式可以定位节点：

```text
hash(key) % 3
```

如果经过上面这个公式计算后得到的值是 0，就说明该 key 需要去第一个节点获取。

但是有一个很致命的问题，**如果节点数量发生了变化，也就是在对系统做扩容或者缩容时，必须迁移改变了映射关系的数据**，否则会出现查询不到数据的问题。

### 3.2 一致性哈希

[什么是一致性哈希？](https://www.xiaolincoding.com/os/8_network_system/hash.html#如何分配请求)

提问：一致性哈希是什么，使用场景，解决了什么问题，存在什么问题？

#### 3.2.1 一致性哈希是什么

一致性Hash算法（Consistent Hashing）是一种分布式系统中常用的负载均衡算法，特别是在分布式缓存、分布式存储等领域有广泛应用。其主要特点是减少了节点变动对系统整体的影响。

一致性哈希算法将哈希空间组织成一个虚拟的环（通常用0到2^32-1表示）。每个节点和数据项都通过哈希函数映射到这个环上的某个位置。数据项被存储在顺时针方向遇到的第一个节点上。当节点加入或离开时，仅需要重新分配很少一部分数据，保持了系统的稳定性和负载均衡。

#### 3.2.2 使用场景

1. **分布式缓存（如Memcached）**：在分布式缓存系统中，节点的加入或退出不会导致大量数据重新分布。
2. **分布式存储系统**：如Cassandra、DynamoDB等，确保数据均匀分布，减少数据迁移。
3. **负载均衡**：在某些负载均衡方案中，一致性哈希用于将请求分配到不同的服务器上。

#### 3.2.3 解决的问题

1. **节点动态变动时的数据迁移**：传统哈希算法在节点变动时会导致大量数据需要重新映射，而一致性哈希只需要重新分配小部分数据，减少了数据迁移量。
2. **负载均衡**：一致性哈希算法能使数据均匀分布在各个节点上，避免了部分节点过载的问题。

#### 3.2.4 存在的问题

1. **热点问题**：在某些情况下，数据可能集中在某些节点上，造成这些节点负载过重。
2. **虚拟节点的引入**：为了解决节点分布不均的问题，通常会引入虚拟节点，这增加了实现的复杂度。
3. **复杂性**：一致性哈希的实现相对于简单哈希算法更复杂，需要额外的计算和维护成本。



#### 3.2.5 原理详解

一致哈希算法也用了取模运算，但与哈希算法不同的是，哈希算法是对节点的数量进行取模运算，而**一致哈希算法是对 2^32 进行取模运算，是一个固定的值**。

我们可以把一致哈希算法是对 2^32 进行取模运算的结果值组织成一个圆环，就像钟表一样，钟表的圆可以理解成由 60 个点组成的圆，而此处我们把这个圆想象成由 2^32 个点组成的圆，这个圆环被称为**哈希环**，如下图：

![img](https://cdn.xiaolincoding.com//mysql/other/0ea3960fef48d4cbaeb4bec4345301e7.png)

一致性哈希要进行两步哈希：

- 第一步：对存储节点进行哈希计算，也就是对存储节点做哈希映射，比如根据节点的 IP 地址进行哈希；
- 第二步：当对数据进行存储或访问时，对数据进行哈希映射；

所以，**一致性哈希是指将「存储节点」和「数据」都映射到一个首尾相连的哈希环上**。



问题来了，对「数据」进行哈希映射得到一个结果要怎么找到存储该数据的节点呢？

答案是，映射的结果值往**顺时针的方向的找到第一个节点**，就是存储该数据的节点。举个例子，有 3 个节点经过哈希计算，映射到了如下图的位置：



**在一致哈希算法中，如果增加或者移除一个节点，仅影响该节点在哈希环上顺时针相邻的后继节点，其它数据也不会受到影响**。

**一致性哈希算法并不保证节点能够在哈希环上分布均匀**，这样就会带来一个问题，会有大量的请求集中在一个节点上。**一致性哈希算法虽然减少了数据迁移量，但是存在节点分布不均匀的问题**。





## 四、最小连接数法

